# ============================================
# CONFIGURACIÓN DE API - REFACTORIZADA
# ============================================

api:
  
  # API REST principal
  rest:
    enabled: "${API_REST_ENABLED:-true}"
    
    server:
      host: "${API_HOST:-0.0.0.0}"
      port: "${API_PORT:-8000}"
      workers: "${API_WORKERS:-4}"
      reload: "${API_RELOAD:-false}"
    
    security:
      cors:
        enabled: true
        allow_origins:
          - "http://localhost:3000"
          - "http://localhost:8080"
          - "https://app.projectbrain.dev"
        allow_methods: ["GET", "POST", "PUT", "DELETE", "OPTIONS"]
        allow_headers: ["Authorization", "Content-Type", "X-Request-ID"]
      
      rate_limiting:
        enabled: "${API_RATE_LIMITING:-true}"
        storage: "redis://${REDIS_HOST:-localhost}:${REDIS_PORT:-6379}/0"
        strategy: "fixed-window"
        
        limits:
          default: "100/minute"
          authenticated: "1000/minute"
          analysis: "10/minute"
          query: "60/minute"
    
    performance:
      compression:
        enabled: true
        minimum_size: 1000
        algorithm: "gzip"
      
      timeouts:
        request: 30
        keepalive: 5
        graceful: 10
    
    documentation:
      enabled: true
      openapi_url: "/openapi.json"
      docs_url: "/docs"
      redoc_url: "/redoc"

  # WebSocket para tiempo real
  websocket:
    enabled: "${API_WS_ENABLED:-true}"
    
    server:
      host: "${WS_HOST:-0.0.0.0}"
      port: "${WS_PORT:-8001}"
      ping_interval: 30
      max_connections: 1000
    
    protocol:
      version: "1.0.0"
      message_types:
        - connect
        - subscribe
        - query
        - analysis_progress
    
    subscriptions:
      enabled: true
      topics:
        - analysis_progress
        - change_detected
        - system_metrics

  # Autenticación y autorización
  authentication:
    enabled: "${API_AUTH_ENABLED:-false}"
    
    methods:
      api_key:
        enabled: true
        header: "X-API-Key"
        rotation_days: 90
        key_length: 32
      
      jwt:
        enabled: true
        algorithm: "HS256"
        secret: "${JWT_SECRET}"
        expiry_hours: 24
    
    roles:
      viewer:
        permissions: ["read", "query"]
      
      analyst:
        permissions: ["read", "query", "analyze"]
      
      admin:
        permissions: ["read", "write", "query", "analyze", "configure"]